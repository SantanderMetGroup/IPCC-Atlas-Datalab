
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Getting started &#8212; The IPCC AR6 Interactive Atlas Datalab (R)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'getting_started';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Projected climate change signals and uncertainty under global warming levels" href="maps_of_change/Maps_of_change_under_global-warming-levels.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">The IPCC AR6 Interactive Atlas Datalab (R)</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    Getting started
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="maps_of_change/Maps_of_change_under_global-warming-levels.html">Projected climate change signals and uncertainty under global warming levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="regional_aggregation/Regional_aggregation_and_visualization.html">Regional averaging of climate information</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/getting_started.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Getting started</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contents-in-this-notebook">Contents in this notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aim-and-motivation">1. Aim and motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#description-of-the-available-material-within-the-datalab">2. Description of the available material within the datalab</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#software">Software</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-loading-and-basic-data-operations">3. Data loading and basic data operations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-structure-of-the-climate4r-grid">3.3. The structure of the <em>climate4R</em> <code class="docutils literal notranslate"><span class="pre">grid</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-data-exploration-plots">3.4. Initial Data Exploration Plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculation-of-anomalies-future-projections-historical-simulations">3.5. Calculation of anomalies (future projections - historical simulations)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-aggregation">3.6. Spatial aggregation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-info">Session Info</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">#</a></h1>
<blockquote>
<div><p>This notebook is a reproducibility example of the IPCC-WGI AR6 Interactive Atlas products. This work is licensed under a <a class="reference external" href="http://creativecommons.org/licenses/by/4.0">Creative Commons Attribution 4.0 International License</a>.</p>
<p><img alt="Creative Commons License &gt;" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></p>
</div></blockquote>
<p><strong>M. Iturbide</strong> (Santander Meteorology Group. Institute of Physics of Cantabria, CSIC-UC, Spain).</p>
<p><strong>Welcome to the datalab “Getting Started” notebook!</strong> This guideline is structured to assist you in harnessing the wealth of resources available within the <strong>IPCC AR6 Interactive Atlas Datalab</strong>, enabling you to conduct meaningful climate research and analysis. The datalab serves as a <strong>reproducibility platform for the IPCC-WG-AR6 Interactive Atlas products</strong>, facilitating not only the reproducibility but also the <strong>reusability of the underlying data</strong>. It offers <strong>transparent access to a wide range of climate-related materials and data</strong>, thereby promoting robust scientific investigations and supporting climate change assessment efforts.</p>
<p>This guideline is divided into several sections. We will begin by outlining the overarching aim and motivation behind the datalab, clarifying its purpose and significance in the realm of climate research. Subsequently, we delve into the Description of the available material within the datalab, providing insights into the diverse datasets and resources at your disposal for climate analysis. Finally, in the section on Data loading and basic data operations, <strong>we walk you through the fundamental steps required to start working with climate data effectively</strong>.</p>
<section id="contents-in-this-notebook">
<h2>Contents in this notebook<a class="headerlink" href="#contents-in-this-notebook" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Aim and motivation</p></li>
<li><p>Description of the available material within the datalab</p></li>
<li><p>Data loading and basic data operations</p>
<ul class="simple">
<li><p>3.1. Library loading</p></li>
<li><p>3.2. Data loading</p></li>
<li><p>3.3. The structure of the <em>climate4R</em> grid</p></li>
<li><p>3.4. Initial Data Exploration Plots</p></li>
<li><p>3.5. Calculation of anomalies (future projections - historical simulations)</p></li>
<li><p>3.6. Spatial aggregation</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<p>Before we start, or at any stage of the notebook, we can customize the plotting area within this notebook as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">repr</span><span class="p">)</span>
<span class="c1"># Change plot size </span>
<span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.width</span><span class="o">=</span><span class="m">18</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.height</span><span class="o">=</span><span class="m">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="aim-and-motivation">
<h2>1. Aim and motivation<a class="headerlink" href="#aim-and-motivation" title="Link to this heading">#</a></h2>
<p>The <strong>IPCC AR6 Interactive Atlas Datalab</strong> aims to <strong>support the reproducibility and reusability</strong> of the data underlying the Interactive Atlas of the IPCC-WGI. It leverages the latest technologies to provide an <strong>efficient research environment that accelerates data analysis</strong>. This is achieved by integrating <strong>data storage and computational resources with ready-to-use software frameworks</strong>. By utilizing these new technologies, climate data analysis can become more efficient, and the legacy of project results can be extended for the benefit of society.</p>
</section>
<section id="description-of-the-available-material-within-the-datalab">
<h2>2. Description of the available material within the datalab<a class="headerlink" href="#description-of-the-available-material-within-the-datalab" title="Link to this heading">#</a></h2>
<p>The datalab is more than just a computing resource; it encompasses <strong>data (including NcML catalogs), software, and notebooks</strong> that facilitate the reproducibility of the IPCC-WGI AR6 Atlas results. Additionally, this material enables the reusability of data, thereby extending the analysis provided by the IPCC-WGI Interactive Atlas.</p>
<section id="software">
<h3>Software<a class="headerlink" href="#software" title="Link to this heading">#</a></h3>
<p>The datalab comes with <strong>pre-installed ready-to-use software</strong> for managing and performing operations with climate data. This software is a collection of <strong>R packages</strong> known as the <strong><code class="docutils literal notranslate"><span class="pre">climate4R</span></code></strong> framework (Iturbide et al., 2019. DOI: <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1364815218303049?via%3Dihub">10.1016/j.envsoft.2018.09.009</a>), which can be selected from the kernel menu. Go to <a class="reference external" href="https://github.com/SantanderMetGroup/climate4R">the climate4R GitHub repository</a> for more information.</p>
<p>For Python users, there is also a <strong><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3</span></code></strong> environment available. It’s worth noting, however, that in this case, the pre-installed software is more basic.</p>
<p>The core <em><strong>climate4R</strong></em> libraries that allow for <strong>data loading, transformation</strong> (e.g. spatio-temporal aggregations), and <strong>visualization</strong> are <code class="docutils literal notranslate"><span class="pre">loadeR</span></code>, <code class="docutils literal notranslate"><span class="pre">transformeR</span></code> and <code class="docutils literal notranslate"><span class="pre">visualizeR</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">loadeR</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">transformeR</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">visualizeR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: rJava

Loading required package: loadeR.java

Java version 20x amd64 by N/A detected

NetCDF Java Library v4.6.0-SNAPSHOT (23 Apr 2015) loaded and ready

Loading required package: climate4R.UDG

climate4R.UDG version 0.2.6 (2023-06-26) is loaded

Please use &#39;citation(&quot;climate4R.UDG&quot;)&#39; to cite this package.

loadeR version 1.8.2 (2024-06-04) is loaded

Please use &#39;citation(&quot;loadeR&quot;)&#39; to cite this package.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    _______   ____  ___________________  __  ________ 
   / ___/ /  / /  |/  / __  /_  __/ __/ / / / / __  / 
  / /  / /  / / /|_/ / /_/ / / / / __/ / /_/ / /_/_/  
 / /__/ /__/ / /  / / __  / / / / /__ /___  / / \ \ 
 \___/____/_/_/  /_/_/ /_/ /_/  \___/    /_/\/   \_\ 
 
      github.com/SantanderMetGroup/climate4R
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>transformeR version 2.2.2 (2023-10-26) is loaded

WARNING: Your current version of transformeR (v2.2.2) is not up-to-date

Get the latest stable version (2.2.3) using &lt;devtools::install_github(&#39;SantanderMetGroup/transformeR&#39;)&gt;

Please see &#39;citation(&quot;transformeR&quot;)&#39; to cite this package.

visualizeR version 1.6.4 (2023-10-26) is loaded

Please see &#39;citation(&quot;visualizeR&quot;)&#39; to cite this package.
</pre></div>
</div>
</div>
</div>
<p>However, the software includes the entire <em>climate4R</em> framework and other useful libraries. For instance, it includes the powerful plotting library <code class="docutils literal notranslate"><span class="pre">lattice</span></code> or the <code class="docutils literal notranslate"><span class="pre">magrittr</span></code> library for piping operations (through <code class="docutils literal notranslate"><span class="pre">%&gt;%</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h3>
<p>The inventory (<code class="docutils literal notranslate"><span class="pre">data_inventory.csv</span></code>) catalogs the list of files of the <a class="reference external" href="https://interactive-atlas.ipcc.ch/"><strong>the IPCC-WGI AR6 Interactive Atlas Dataset</strong></a>, originally published at <a class="reference external" href="https://digital.csic.es/handle/10261/280324"><strong>DIGITAL.CSIC</strong></a> for the long-term archival, and also available through the Copernicus Data Store (<strong>CDS</strong>).</p>
<p>We simply need to read this file with the <code class="docutils literal notranslate"><span class="pre">read.csv</span></code> function to get the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> of this information, which contains four columns: <code class="docutils literal notranslate"><span class="pre">location</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">variable</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, <code class="docutils literal notranslate"><span class="pre">experiment</span></code>, <code class="docutils literal notranslate"><span class="pre">frequency</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;../../data_inventory.csv&quot;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 6</caption>
<thead>
	<tr><th></th><th scope=col>location</th><th scope=col>type</th><th scope=col>variable</th><th scope=col>project</th><th scope=col>experiment</th><th scope=col>frequency</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>https://hub.climate4r.ifca.es/thredds/dodsC/ipcc/ar6/atlas/ia-monthly/CORDEX-ANT/historical/pr_CORDEX-ANT_historical_mon_197001-200512.nc    </td><td>opendap</td><td>pr    </td><td>CORDEX-ANT</td><td>historical</td><td>mon</td></tr>
	<tr><th scope=row>2</th><td>https://hub.climate4r.ifca.es/thredds/dodsC/ipcc/ar6/atlas/ia-monthly/CORDEX-ANT/historical/tn_CORDEX-ANT_historical_mon_197001-200512.nc    </td><td>opendap</td><td>tn    </td><td>CORDEX-ANT</td><td>historical</td><td>mon</td></tr>
	<tr><th scope=row>3</th><td>https://hub.climate4r.ifca.es/thredds/dodsC/ipcc/ar6/atlas/ia-monthly/CORDEX-ANT/historical/rx1day_CORDEX-ANT_historical_mon_197001-200512.nc</td><td>opendap</td><td>rx1day</td><td>CORDEX-ANT</td><td>historical</td><td>mon</td></tr>
	<tr><th scope=row>4</th><td>https://hub.climate4r.ifca.es/thredds/dodsC/ipcc/ar6/atlas/ia-monthly/CORDEX-ANT/historical/tx_CORDEX-ANT_historical_mon_197001-200512.nc    </td><td>opendap</td><td>tx    </td><td>CORDEX-ANT</td><td>historical</td><td>mon</td></tr>
	<tr><th scope=row>5</th><td>https://hub.climate4r.ifca.es/thredds/dodsC/ipcc/ar6/atlas/ia-monthly/CORDEX-ANT/historical/txx_CORDEX-ANT_historical_mon_197001-200512.nc   </td><td>opendap</td><td>txx   </td><td>CORDEX-ANT</td><td>historical</td><td>mon</td></tr>
	<tr><th scope=row>6</th><td>https://hub.climate4r.ifca.es/thredds/dodsC/ipcc/ar6/atlas/ia-monthly/CORDEX-ANT/historical/tnn_CORDEX-ANT_historical_mon_197001-200512.nc   </td><td>opendap</td><td>tnn   </td><td>CORDEX-ANT</td><td>historical</td><td>mon</td></tr>
</tbody>
</table>
</div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">location</span></code> refers to the path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> refers to the access mode, local (netcdf) or remote (opendap).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">variable</span></code> referst to the climatic variable or index (i.e. tas, pr, tn, rx1day, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project</span></code> refers to the project coordinating the datasets (i.e. CORDEX-EUR, CMIP5, CMIP6, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">experiment</span></code> referst to the scenario (i.e. historical, rcp26, ssp126, rcp85, etc.)</p></li>
</ul>
<p>We can easily apply filters to narrow down to the desired file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;CMIP6&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;pr&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">experiment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;historical&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;opendap&quot;</span><span class="p">)</span>
<span class="n">data.file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="o">$</span><span class="n">location</span>
</pre></div>
</div>
</div>
</div>
<p>Once we have the path of the desired data file, we can easily display the characteristics of the data it contains. To do this, we use the <code class="docutils literal notranslate"><span class="pre">dataInventory</span></code> function from the <code class="docutils literal notranslate"><span class="pre">loadeR</span></code> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">di</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dataInventory</span><span class="p">(</span><span class="n">data.file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 10:59:42.024006] Doing inventory ...

[2024-11-08 10:59:42.094116] Opening dataset...

[2024-11-08 10:59:43.237541] The dataset was successfuly opened

[2024-11-08 10:59:43.546959] Retrieving info for &#39;pr&#39; (0 vars remaining)

[2024-11-08 10:59:43.613328] Done.
</pre></div>
</div>
</div>
</div>
<p>We could check for instance the members (CMIP6 models),</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">di</span><span class="o">$</span><span class="n">pr</span><span class="o">$</span><span class="n">Dimensions</span><span class="o">$</span><span class="n">member</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><dl>
	<dt>$Type</dt>
		<dd>'Ensemble'</dd>
	<dt>$Units</dt>
		<dd>''</dd>
	<dt>$Values</dt>
		<dd><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'CSIRO-ARCCSS_ACCESS-CM2_r1i1p1f1'</li><li>'CSIRO_ACCESS-ESM1-5_r1i1p1f1'</li><li>'BCC_BCC-CSM2-MR_r1i1p1f1'</li><li>'CAMS_CAMS-CSM1-0_r2i1p1f1'</li><li>'NCAR_CESM2-WACCM_r1i1p1f1'</li><li>'NCAR_CESM2_r4i1p1f1'</li><li>'CMCC_CMCC-CM2-SR5_r1i1p1f1'</li><li>'CNRM-CERFACS_CNRM-CM6-1-HR_r1i1p1f2'</li><li>'CNRM-CERFACS_CNRM-CM6-1_r1i1p1f2'</li><li>'CNRM-CERFACS_CNRM-ESM2-1_r1i1p1f2'</li><li>'CCCma_CanESM5_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3-Veg-LR_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3-Veg_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3_r1i1p1f1'</li><li>'CAS_FGOALS-g3_r1i1p1f1'</li><li>'NOAA-GFDL_GFDL-CM4_r1i1p1f1'</li><li>'NOAA-GFDL_GFDL-ESM4_r1i1p1f1'</li><li>'MOHC_HadGEM3-GC31-LL_r1i1p1f3'</li><li>'CCCR-IITM_IITM-ESM_r1i1p1f1'</li><li>'INM_INM-CM4-8_r1i1p1f1'</li><li>'INM_INM-CM5-0_r1i1p1f1'</li><li>'IPSL_IPSL-CM6A-LR_r1i1p1f1'</li><li>'NIMS-KMA_KACE-1-0-G_r2i1p1f1'</li><li>'KIOST_KIOST-ESM_r1i1p1f1'</li><li>'MIROC_MIROC-ES2L_r1i1p1f2'</li><li>'MIROC_MIROC6_r1i1p1f1'</li><li>'MPI-M_MPI-ESM1-2-HR_r1i1p1f1'</li><li>'MPI-M_MPI-ESM1-2-LR_r1i1p1f1'</li><li>'MRI_MRI-ESM2-0_r1i1p1f1'</li><li>'NUIST_NESM3_r1i1p1f1'</li><li>'NCC_NorESM2-LM_r1i1p1f1'</li><li>'NCC_NorESM2-MM_r1i1p1f1'</li><li>'AS-RCEC_TaiESM1_r1i1p1f1'</li><li>'MOHC_UKESM1-0-LL_r1i1p1f2'</li></ol>
</dd>
</dl>
</div></div>
</div>
<p>or the description of the index, the corresponding units and the time resolution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">di</span><span class="o">$</span><span class="n">pr</span><span class="o">$</span><span class="n">Description</span>
<span class="n">di</span><span class="o">$</span><span class="n">pr</span><span class="o">$</span><span class="n">Units</span>
<span class="n">di</span><span class="o">$</span><span class="n">pr</span><span class="o">$</span><span class="n">Dimensions</span><span class="o">$</span><span class="n">time</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">'Monthly mean of daily accumulated precipitation'</div><div class="output text_html">'mm'</div><div class="output text_html"><dl>
	<dt>$Type</dt>
		<dd>'Time'</dd>
	<dt>$TimeStep</dt>
		<dd>'30.436 days'</dd>
	<dt>$Units</dt>
		<dd>'days since 1850-01-01 00:00:00'</dd>
	<dt>$Date_range</dt>
		<dd>'1850-01-01T00:00:00Z - 2014-12-01T00:00:00Z'</dd>
</dl>
</div></div>
</div>
</section>
</section>
<section id="data-loading-and-basic-data-operations">
<h2>3. Data loading and basic data operations<a class="headerlink" href="#data-loading-and-basic-data-operations" title="Link to this heading">#</a></h2>
<p>Data loading is performed using the <code class="docutils literal notranslate"><span class="pre">loadGridData</span></code> function, which allows to point to a NetCDF file (object <code class="docutils literal notranslate"><span class="pre">data.file</span></code> in this example) or an NcML catalog as the data source.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">var</span></code> parameter also needs to be specified, in this example as <code class="docutils literal notranslate"><span class="pre">pr</span></code> (mean precipitation). Note that <code class="docutils literal notranslate"><span class="pre">loadGridData</span></code> allows for additional parameter settings. We use <code class="docutils literal notranslate"><span class="pre">lonLim</span></code> and <code class="docutils literal notranslate"><span class="pre">latLim</span></code> to load only the subset of data over the Iberian Peninsula, and <code class="docutils literal notranslate"><span class="pre">season</span></code> to load data for specific months (in this example, JJA for boreal summer). In the <code class="docutils literal notranslate"><span class="pre">years</span></code> parameter, we specify the desired period (here, preindustrial). Run <code class="docutils literal notranslate"><span class="pre">help(loadGridData)</span></code> to check other available parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6.hist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">loadGridData</span><span class="p">(</span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.file</span><span class="p">,</span>
<span class="w">             </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pr&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="n">lonLim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">latLim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">36</span><span class="p">,</span><span class="w"> </span><span class="m">44</span><span class="p">),</span>
<span class="w">             </span><span class="n">season</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">8</span><span class="p">,</span>
<span class="w">             </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1850</span><span class="o">:</span><span class="m">1900</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 10:59:43.818408] Opening dataset...

[2024-11-08 10:59:44.209382] The dataset was successfuly opened

[2024-11-08 10:59:44.215631] Defining geo-location parameters

[2024-11-08 10:59:44.272027] Defining time selection parameters

[2024-11-08 10:59:44.306239] Retrieving data subset ...

[2024-11-08 10:59:57.694737] Done
</pre></div>
</div>
</div>
</div>
<section id="the-structure-of-the-climate4r-grid">
<h3>3.3. The structure of the <em>climate4R</em> <code class="docutils literal notranslate"><span class="pre">grid</span></code><a class="headerlink" href="#the-structure-of-the-climate4r-grid" title="Link to this heading">#</a></h3>
<p>The resulting object (here named <code class="docutils literal notranslate"><span class="pre">cmip6.hist</span></code>) is a <em>climate4R</em> <em>grid</em>, which is a <code class="docutils literal notranslate"><span class="pre">list</span></code> object containing the following slots: <code class="docutils literal notranslate"><span class="pre">Variable</span></code>, <code class="docutils literal notranslate"><span class="pre">Data</span></code>, <code class="docutils literal notranslate"><span class="pre">xyCoordinates</span></code>, <code class="docutils literal notranslate"><span class="pre">Dates</span></code>, and <code class="docutils literal notranslate"><span class="pre">Members</span></code>. The <code class="docutils literal notranslate"><span class="pre">InitializationDates</span></code> slot can be ignored here, as it is related to seasonal forecasting data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">cmip6.hist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of 6
 $ Variable           :List of 2
  ..$ varName: chr &quot;pr&quot;
  ..$ level  : NULL
  ..- attr(*, &quot;use_dictionary&quot;)= logi FALSE
  ..- attr(*, &quot;description&quot;)= chr &quot;Monthly mean of daily accumulated precipitation&quot;
  ..- attr(*, &quot;units&quot;)= chr &quot;mm&quot;
  ..- attr(*, &quot;longname&quot;)= chr &quot;pr&quot;
  ..- attr(*, &quot;daily_agg_cellfun&quot;)= chr &quot;none&quot;
  ..- attr(*, &quot;monthly_agg_cellfun&quot;)= chr &quot;none&quot;
  ..- attr(*, &quot;verification_time&quot;)= chr &quot;none&quot;
 $ Data               : num [1:34, 1:153, 1:9, 1:15] 0.0801 0.832 1.7773 0.0732 0.2559 ...
  ..- attr(*, &quot;dimensions&quot;)= chr [1:4] &quot;member&quot; &quot;time&quot; &quot;lat&quot; &quot;lon&quot;
 $ xyCoords           :List of 2
  ..$ x: num [1:15] -9.5 -8.5 -7.5 -6.5 -5.5 -4.5 -3.5 -2.5 -1.5 -0.5 ...
  ..$ y: num [1:9] 36.5 37.5 38.5 39.5 40.5 41.5 42.5 43.5 44.5
  ..- attr(*, &quot;projection&quot;)= chr &quot;LatLonProjection&quot;
  ..- attr(*, &quot;resX&quot;)= num 1
  ..- attr(*, &quot;resY&quot;)= num 1
 $ Dates              :List of 2
  ..$ start: chr [1:153] &quot;1850-06-01 00:00:00 GMT&quot; &quot;1850-07-01 00:00:00 GMT&quot; &quot;1850-08-01 00:00:00 GMT&quot; &quot;1851-06-01 00:00:00 GMT&quot; ...
  ..$ end  : chr [1:153] &quot;1850-06-01 00:00:00 GMT&quot; &quot;1850-07-01 00:00:00 GMT&quot; &quot;1850-08-01 00:00:00 GMT&quot; &quot;1851-06-01 00:00:00 GMT&quot; ...
 $ Members            : chr [1:34] &quot;CSIRO-ARCCSS_ACCESS-CM2_r1i1p1f1&quot; &quot;CSIRO_ACCESS-ESM1-5_r1i1p1f1&quot; &quot;BCC_BCC-CSM2-MR_r1i1p1f1&quot; &quot;CAMS_CAMS-CSM1-0_r2i1p1f1&quot; ...
 $ InitializationDates:List of 34
  ..$ CSIRO-ARCCSS_ACCESS-CM2_r1i1p1f1             : NULL
  ..$ CSIRO_ACCESS-ESM1-5_r1i1p1f1                 : NULL
  ..$ BCC_BCC-CSM2-MR_r1i1p1f1                     : NULL
  ..$ CAMS_CAMS-CSM1-0_r2i1p1f1                    : NULL
  ..$ NCAR_CESM2-WACCM_r1i1p1f1                    : NULL
  ..$ NCAR_CESM2_r4i1p1f1                          : NULL
  ..$ CMCC_CMCC-CM2-SR5_r1i1p1f1                   : NULL
  ..$ CNRM-CERFACS_CNRM-CM6-1-HR_r1i1p1f2          : NULL
  ..$ CNRM-CERFACS_CNRM-CM6-1_r1i1p1f2             : NULL
  ..$ CNRM-CERFACS_CNRM-ESM2-1_r1i1p1f2            : NULL
  ..$ CCCma_CanESM5_r1i1p1f1                       : NULL
  ..$ EC-Earth-Consortium_EC-Earth3-Veg-LR_r1i1p1f1: NULL
  ..$ EC-Earth-Consortium_EC-Earth3-Veg_r1i1p1f1   : NULL
  ..$ EC-Earth-Consortium_EC-Earth3_r1i1p1f1       : NULL
  ..$ CAS_FGOALS-g3_r1i1p1f1                       : NULL
  ..$ NOAA-GFDL_GFDL-CM4_r1i1p1f1                  : NULL
  ..$ NOAA-GFDL_GFDL-ESM4_r1i1p1f1                 : NULL
  ..$ MOHC_HadGEM3-GC31-LL_r1i1p1f3                : NULL
  ..$ CCCR-IITM_IITM-ESM_r1i1p1f1                  : NULL
  ..$ INM_INM-CM4-8_r1i1p1f1                       : NULL
  ..$ INM_INM-CM5-0_r1i1p1f1                       : NULL
  ..$ IPSL_IPSL-CM6A-LR_r1i1p1f1                   : NULL
  ..$ NIMS-KMA_KACE-1-0-G_r2i1p1f1                 : NULL
  ..$ KIOST_KIOST-ESM_r1i1p1f1                     : NULL
  ..$ MIROC_MIROC-ES2L_r1i1p1f2                    : NULL
  ..$ MIROC_MIROC6_r1i1p1f1                        : NULL
  ..$ MPI-M_MPI-ESM1-2-HR_r1i1p1f1                 : NULL
  ..$ MPI-M_MPI-ESM1-2-LR_r1i1p1f1                 : NULL
  ..$ MRI_MRI-ESM2-0_r1i1p1f1                      : NULL
  ..$ NUIST_NESM3_r1i1p1f1                         : NULL
  ..$ NCC_NorESM2-LM_r1i1p1f1                      : NULL
  ..$ NCC_NorESM2-MM_r1i1p1f1                      : NULL
  ..$ AS-RCEC_TaiESM1_r1i1p1f1                     : NULL
  ..$ MOHC_UKESM1-0-LL_r1i1p1f2                    : NULL
 - attr(*, &quot;dataset&quot;)= chr &quot;https://hub.climate4r.ifca.es/thredds/dodsC/ipcc/ar6/atlas/ia-monthly/CMIP6/historical/pr_CMIP6_historical_mon_&quot;| __truncated__
 - attr(*, &quot;R_package_desc&quot;)= chr &quot;loadeR-v1.8.2&quot;
 - attr(*, &quot;R_package_URL&quot;)= chr &quot;https://github.com/SantanderMetGroup/loadeR&quot;
 - attr(*, &quot;R_package_ref&quot;)= chr &quot;https://doi.org/10.1016/j.envsoft.2018.09.009&quot;
</pre></div>
</div>
</div>
</div>
<p>Therefore, the information can be extracted using <code class="docutils literal notranslate"><span class="pre">$</span></code>. For instance, the data array can be extracted executing <code class="docutils literal notranslate"><span class="pre">cmip6.hist$Data</span></code>. Here we also apply <code class="docutils literal notranslate"><span class="pre">str</span></code> to display the structure of the data array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data.array</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmip6.hist</span><span class="o">$</span><span class="n">Data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">str</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> num [1:34, 1:153, 1:9, 1:15] 0.0801 0.832 1.7773 0.0732 0.2559 ...
 - attr(*, &quot;dimensions&quot;)= chr [1:4] &quot;member&quot; &quot;time&quot; &quot;lat&quot; &quot;lon&quot;
</pre></div>
</div>
</div>
</div>
<p>However, <strong>as the <em>climate4R</em> functions work with the <code class="docutils literal notranslate"><span class="pre">grid</span></code> structure transparently, there is no need to extract any component of the list to perform different transformation and visualization operations.</strong></p>
</section>
<section id="initial-data-exploration-plots">
<h3>3.4. Initial Data Exploration Plots<a class="headerlink" href="#initial-data-exploration-plots" title="Link to this heading">#</a></h3>
<p>Before we continue we can take a look at the data by, for instance, plotting maps. To do so we first compute the climatology with function <code class="docutils literal notranslate"><span class="pre">climatology</span></code> from the <code class="docutils literal notranslate"><span class="pre">transformeR</span></code> package. Finally, we use the <code class="docutils literal notranslate"><span class="pre">spatialPlot</span></code> function from the <code class="docutils literal notranslate"><span class="pre">visualizeR</span></code> package (run <code class="docutils literal notranslate"><span class="pre">help(spatialPlot)</span></code> to check different plotting parameters).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6.hist.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">climatology</span><span class="p">(</span><span class="n">cmip6.hist</span><span class="p">)</span><span class="w"> </span>
<span class="nf">spatialPlot</span><span class="p">(</span><span class="n">cmip6.hist.c</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">backdrop.theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;coastline&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">col.theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Blues&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">),</span>
<span class="w">            </span><span class="n">set.max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">set.min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">            </span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span>
<span class="w">            </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Mean precipitation (mm/day) in the preindustrial period&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">strip.custom</span><span class="p">(</span><span class="n">factor.levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmip6.hist.c</span><span class="o">$</span><span class="n">Members</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 10:59:57.7728] - Computing climatology...

[2024-11-08 10:59:57.827338] - Done.
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/d29512bfb340ac0e403ac4a45318c3791a4526752be37dde54c49324e08381f7.png"><img alt="_images/d29512bfb340ac0e403ac4a45318c3791a4526752be37dde54c49324e08381f7.png" src="_images/d29512bfb340ac0e403ac4a45318c3791a4526752be37dde54c49324e08381f7.png" style="width: 1080px; height: 480px;" /></a>
</div>
</div>
<p>We could also display the temporal series with <code class="docutils literal notranslate"><span class="pre">temporalPlot</span></code> for the original monthly values…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">temporalPlot</span><span class="p">(</span><span class="n">cmip6.hist</span><span class="p">,</span><span class="w"> </span><span class="n">xyplot.custom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Precipitation (mm/day) during summer months in the preindustrial era in the Iberian Peninsula.&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pad applied on the interval: month
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/4dc44f968a5b3d6b8e42ed3e4377319a9f0352f6fe11c2e062fc2d6cc967b9d0.png"><img alt="_images/4dc44f968a5b3d6b8e42ed3e4377319a9f0352f6fe11c2e062fc2d6cc967b9d0.png" src="_images/4dc44f968a5b3d6b8e42ed3e4377319a9f0352f6fe11c2e062fc2d6cc967b9d0.png" style="width: 1080px; height: 480px;" /></a>
</div>
</div>
<p>…or the aggregated yearly values by previously applying the <code class="docutils literal notranslate"><span class="pre">aggregateGrid</span></code> function (we will change the color this time, run <code class="docutils literal notranslate"><span class="pre">help(temporalPlot)</span></code> for further customization):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6.hist.y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregateGrid</span><span class="p">(</span><span class="n">cmip6.hist</span><span class="p">,</span><span class="w"> </span><span class="n">aggr.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">))</span>
<span class="nf">temporalPlot</span><span class="p">(</span><span class="n">cmip6.hist.y</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;orange&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="n">xyplot.custom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Summer mean precipitation (mm/day) in the preindustrial era in the Iberian Peninsula.&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 11:00:02.105277] Performing annual aggregation...

[2024-11-08 11:00:03.369865] Done.

pad applied on the interval: year
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/0dbe0f1b4528806027ada754b86195f18f8798e028da3101a5bf17373ce3f485.png"><img alt="_images/0dbe0f1b4528806027ada754b86195f18f8798e028da3101a5bf17373ce3f485.png" src="_images/0dbe0f1b4528806027ada754b86195f18f8798e028da3101a5bf17373ce3f485.png" style="width: 1080px; height: 480px;" /></a>
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">temporalPlot</span></code> function recognizes that <strong>our grid is multi-member (multi-model in this case)</strong> and shows the ensemble mean (solid line) and the multi-member spread (shadow).</p>
</section>
<section id="calculation-of-anomalies-future-projections-historical-simulations">
<h3>3.5. Calculation of anomalies (future projections - historical simulations)<a class="headerlink" href="#calculation-of-anomalies-future-projections-historical-simulations" title="Link to this heading">#</a></h3>
<p>We will now calculate the relative precipitation anomaly of a fixed future period (e.g. 2041-2060) relative to the preindustrial period. We will consider the SSP585 mitigation scenario. Therefore, we now point to another data source:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data.file.ssp585</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;CMIP6&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;pr&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">experiment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;ssp585&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;opendap&quot;</span><span class="p">)[[</span><span class="s">&quot;location&quot;</span><span class="p">]]</span>
<span class="n">cmip6.fut</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">loadGridData</span><span class="p">(</span><span class="n">data.file.ssp585</span><span class="p">,</span>
<span class="w">             </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pr&quot;</span><span class="p">,</span>
<span class="w">             </span><span class="n">lonLim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">latLim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">36</span><span class="p">,</span><span class="w"> </span><span class="m">44</span><span class="p">),</span>
<span class="w">             </span><span class="n">season</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="o">:</span><span class="m">8</span><span class="p">,</span>
<span class="w">             </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2041</span><span class="o">:</span><span class="m">2060</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 11:00:03.758623] Opening dataset...

[2024-11-08 11:00:04.096763] The dataset was successfuly opened

[2024-11-08 11:00:04.10151] Defining geo-location parameters

[2024-11-08 11:00:04.165869] Defining time selection parameters

[2024-11-08 11:00:04.185969] Retrieving data subset ...

[2024-11-08 11:00:09.657921] Done
</pre></div>
</div>
</div>
</div>
<p>We can combine the output with the historical data in the same time-series plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6.fut.y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregateGrid</span><span class="p">(</span><span class="n">cmip6.fut</span><span class="p">,</span><span class="w"> </span><span class="n">aggr.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">))</span>
<span class="nf">temporalPlot</span><span class="p">(</span><span class="n">cmip6.hist.y</span><span class="p">,</span><span class="w"> </span><span class="n">cmip6.fut.y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 11:00:09.676278] Performing annual aggregation...

[2024-11-08 11:00:10.236048] Done.

pad applied on the interval: year

pad applied on the interval: year
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/3ef91baca2aa1c388af7e94b5c43b4a7de6b857249d63b6ddf1941702473ebc4.png"><img alt="_images/3ef91baca2aa1c388af7e94b5c43b4a7de6b857249d63b6ddf1941702473ebc4.png" src="_images/3ef91baca2aa1c388af7e94b5c43b4a7de6b857249d63b6ddf1941702473ebc4.png" style="width: 1080px; height: 480px;" /></a>
</div>
</div>
<p>Lets calculate the anomaly. To do so, we must retain the common available members in both grids. These are de members (CMIP6 models) in the historical period:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6.hist</span><span class="o">$</span><span class="n">Members</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'CSIRO-ARCCSS_ACCESS-CM2_r1i1p1f1'</li><li>'CSIRO_ACCESS-ESM1-5_r1i1p1f1'</li><li>'BCC_BCC-CSM2-MR_r1i1p1f1'</li><li>'CAMS_CAMS-CSM1-0_r2i1p1f1'</li><li>'NCAR_CESM2-WACCM_r1i1p1f1'</li><li>'NCAR_CESM2_r4i1p1f1'</li><li>'CMCC_CMCC-CM2-SR5_r1i1p1f1'</li><li>'CNRM-CERFACS_CNRM-CM6-1-HR_r1i1p1f2'</li><li>'CNRM-CERFACS_CNRM-CM6-1_r1i1p1f2'</li><li>'CNRM-CERFACS_CNRM-ESM2-1_r1i1p1f2'</li><li>'CCCma_CanESM5_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3-Veg-LR_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3-Veg_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3_r1i1p1f1'</li><li>'CAS_FGOALS-g3_r1i1p1f1'</li><li>'NOAA-GFDL_GFDL-CM4_r1i1p1f1'</li><li>'NOAA-GFDL_GFDL-ESM4_r1i1p1f1'</li><li>'MOHC_HadGEM3-GC31-LL_r1i1p1f3'</li><li>'CCCR-IITM_IITM-ESM_r1i1p1f1'</li><li>'INM_INM-CM4-8_r1i1p1f1'</li><li>'INM_INM-CM5-0_r1i1p1f1'</li><li>'IPSL_IPSL-CM6A-LR_r1i1p1f1'</li><li>'NIMS-KMA_KACE-1-0-G_r2i1p1f1'</li><li>'KIOST_KIOST-ESM_r1i1p1f1'</li><li>'MIROC_MIROC-ES2L_r1i1p1f2'</li><li>'MIROC_MIROC6_r1i1p1f1'</li><li>'MPI-M_MPI-ESM1-2-HR_r1i1p1f1'</li><li>'MPI-M_MPI-ESM1-2-LR_r1i1p1f1'</li><li>'MRI_MRI-ESM2-0_r1i1p1f1'</li><li>'NUIST_NESM3_r1i1p1f1'</li><li>'NCC_NorESM2-LM_r1i1p1f1'</li><li>'NCC_NorESM2-MM_r1i1p1f1'</li><li>'AS-RCEC_TaiESM1_r1i1p1f1'</li><li>'MOHC_UKESM1-0-LL_r1i1p1f2'</li></ol>
</div></div>
</div>
<p>and these in the future period for the SSP585 scenario:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6.fut</span><span class="o">$</span><span class="n">Members</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'CSIRO-ARCCSS_ACCESS-CM2_r1i1p1f1'</li><li>'CSIRO_ACCESS-ESM1-5_r1i1p1f1'</li><li>'BCC_BCC-CSM2-MR_r1i1p1f1'</li><li>'CAMS_CAMS-CSM1-0_r2i1p1f1'</li><li>'NCAR_CESM2-WACCM_r1i1p1f1'</li><li>'NCAR_CESM2_r4i1p1f1'</li><li>'CMCC_CMCC-CM2-SR5_r1i1p1f1'</li><li>'CNRM-CERFACS_CNRM-CM6-1-HR_r1i1p1f2'</li><li>'CNRM-CERFACS_CNRM-CM6-1_r1i1p1f2'</li><li>'CNRM-CERFACS_CNRM-ESM2-1_r1i1p1f2'</li><li>'CCCma_CanESM5_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3-Veg_r1i1p1f1'</li><li>'EC-Earth-Consortium_EC-Earth3_r1i1p1f1'</li><li>'CAS_FGOALS-g3_r1i1p1f1'</li><li>'NOAA-GFDL_GFDL-CM4_r1i1p1f1'</li><li>'NOAA-GFDL_GFDL-ESM4_r1i1p1f1'</li><li>'MOHC_HadGEM3-GC31-LL_r1i1p1f3'</li><li>'CCCR-IITM_IITM-ESM_r1i1p1f1'</li><li>'INM_INM-CM4-8_r1i1p1f1'</li><li>'INM_INM-CM5-0_r1i1p1f1'</li><li>'IPSL_IPSL-CM6A-LR_r1i1p1f1'</li><li>'NIMS-KMA_KACE-1-0-G_r2i1p1f1'</li><li>'KIOST_KIOST-ESM_r1i1p1f1'</li><li>'MIROC_MIROC-ES2L_r1i1p1f2'</li><li>'MIROC_MIROC6_r1i1p1f1'</li><li>'MPI-M_MPI-ESM1-2-HR_r1i1p1f1'</li><li>'MPI-M_MPI-ESM1-2-LR_r1i1p1f1'</li><li>'MRI_MRI-ESM2-0_r1i1p1f1'</li><li>'NUIST_NESM3_r1i1p1f1'</li><li>'NCC_NorESM2-LM_r1i1p1f1'</li><li>'NCC_NorESM2-MM_r1i1p1f1'</li><li>'AS-RCEC_TaiESM1_r1i1p1f1'</li><li>'MOHC_UKESM1-0-LL_r1i1p1f2'</li></ol>
</div></div>
</div>
<p>As is the case in this example, different scenarios for different variables may have less members than the corresponding historical experiment. We can therefore subset the historical grid to match the members with the future grid. An easy way to retain the common members in both grids is to use the function <code class="docutils literal notranslate"><span class="pre">intersectGrid</span></code> (which also allows for spatial and temporal intersections, by changing the value in the <code class="docutils literal notranslate"><span class="pre">type</span></code> argument):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">cmip6.common.mems</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">intersectGrid</span><span class="p">(</span><span class="n">cmip6.hist</span><span class="p">,</span><span class="w"> </span><span class="n">cmip6.fut</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;members&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">which.return</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="n">cmip6.hist.s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmip6.common.mems</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">cmip6.fut</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cmip6.common.mems</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>It is always a good practice to make sure that the members in both grids are identical:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">identical</span><span class="p">(</span><span class="n">cmip6.hist.s</span><span class="o">$</span><span class="n">Members</span><span class="p">,</span><span class="w"> </span><span class="n">cmip6.fut</span><span class="o">$</span><span class="n">Members</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">TRUE</div></div>
</div>
<p>Now we can calculate the anomaly by computing the difference between both climatologies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">anom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gridArithmetics</span><span class="p">(</span><span class="nf">climatology</span><span class="p">(</span><span class="n">cmip6.fut</span><span class="p">),</span><span class="w"> </span><span class="nf">climatology</span><span class="p">(</span><span class="n">cmip6.hist.s</span><span class="p">),</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 11:00:10.526133] - Computing climatology...

[2024-11-08 11:00:10.706641] - Done.

[2024-11-08 11:00:10.71262] - Computing climatology...

[2024-11-08 11:00:10.745056] - Done.
</pre></div>
</div>
</div>
</div>
<p>We can calculate the relative anomaly the same way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rel.anom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gridArithmetics</span><span class="p">(</span><span class="n">anom</span><span class="p">,</span><span class="w"> </span><span class="nf">climatology</span><span class="p">(</span><span class="n">cmip6.hist.s</span><span class="p">),</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 11:00:10.766294] - Computing climatology...

[2024-11-08 11:00:10.805385] - Done.
</pre></div>
</div>
</div>
</div>
<p>Finally, we can plot the output using an appropriate palette for the <code class="docutils literal notranslate"><span class="pre">color.theme</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">spatialPlot</span><span class="p">(</span><span class="n">rel.anom</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">color.theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BrBG&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">backdrop.theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;coastline&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">-50</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">),</span>
<span class="w">            </span><span class="n">set.max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">set.min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-50</span><span class="p">,</span>
<span class="w">            </span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span>
<span class="w">            </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Mean precipitation relative anomaly (mm/day)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">strip.custom</span><span class="p">(</span><span class="n">factor.levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmip6.fut</span><span class="o">$</span><span class="n">Members</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/f924b9832e85e0d8816dc4d88558a45e27544581a6e661c10f2f8592029a647a.png"><img alt="_images/f924b9832e85e0d8816dc4d88558a45e27544581a6e661c10f2f8592029a647a.png" src="_images/f924b9832e85e0d8816dc4d88558a45e27544581a6e661c10f2f8592029a647a.png" style="width: 1080px; height: 480px;" /></a>
</div>
</div>
<p>We can do the same for the multi-model ensemble mean by previously applying the <code class="docutils literal notranslate"><span class="pre">aggregateGrid</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">ens.mean.anom</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregateGrid</span><span class="p">(</span><span class="n">rel.anom</span><span class="p">,</span><span class="w"> </span><span class="n">aggr.mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
<span class="nf">spatialPlot</span><span class="p">(</span><span class="n">ens.mean.anom</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">color.theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BrBG&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">backdrop.theme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;coastline&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">-55</span><span class="p">,</span><span class="w"> </span><span class="m">55</span><span class="p">),</span>
<span class="w">            </span><span class="n">set.max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">55</span><span class="p">,</span><span class="w"> </span><span class="n">set.min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-55</span><span class="p">,</span>
<span class="w">            </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Mean precipitation relative anomaly (mm/day)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">strip.custom</span><span class="p">(</span><span class="n">factor.levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmip6.fut</span><span class="o">$</span><span class="n">Members</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 11:00:14.246094] - Aggregating members...

[2024-11-08 11:00:14.248896] - Done.
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/5e04367eba49f6559f15de5afba1b94905a62667bd277f4db4befafb8c6c9473.png"><img alt="_images/5e04367eba49f6559f15de5afba1b94905a62667bd277f4db4befafb8c6c9473.png" src="_images/5e04367eba49f6559f15de5afba1b94905a62667bd277f4db4befafb8c6c9473.png" style="width: 1080px; height: 480px;" /></a>
</div>
</div>
</section>
<section id="spatial-aggregation">
<h3>3.6. Spatial aggregation<a class="headerlink" href="#spatial-aggregation" title="Link to this heading">#</a></h3>
<p>The time series plots we have created above, automatically performs spatial aggregations. However, we can control this operation by using the <code class="docutils literal notranslate"><span class="pre">aggr.spatial</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">aggregateGrid</span></code> function, which by default calculates weighted values according to the latitude. If we aggregate the <code class="docutils literal notranslate"><span class="pre">rel.anom</span></code> object, we will get a single value per model (member).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">rel.anom.regional_mean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregateGrid</span><span class="p">(</span><span class="n">rel.anom</span><span class="p">,</span><span class="w"> </span><span class="n">aggr.spatial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calculating areal weights...

[2024-11-08 11:00:14.441585] - Aggregating spatially...

[2024-11-08 11:00:14.443421] - Done.
</pre></div>
</div>
</div>
</div>
<p>In the next code chunk we get the multi-model mean and the percentiles:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregateGrid</span><span class="p">(</span><span class="n">rel.anom.regional_mean</span><span class="p">,</span><span class="w"> </span><span class="n">aggr.mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span>
<span class="n">p25</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregateGrid</span><span class="p">(</span><span class="n">rel.anom.regional_mean</span><span class="p">,</span><span class="w"> </span><span class="n">aggr.mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;quantile&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span>
<span class="n">p75</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregateGrid</span><span class="p">(</span><span class="n">rel.anom.regional_mean</span><span class="p">,</span><span class="w"> </span><span class="n">aggr.mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;quantile&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">prob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span>

<span class="nf">c</span><span class="p">(</span><span class="s">&quot;mean&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">$</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;P25&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p25</span><span class="o">$</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;P75&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p75</span><span class="o">$</span><span class="n">Data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2024-11-08 11:00:14.456018] - Aggregating members...

[2024-11-08 11:00:14.457539] - Done.

[2024-11-08 11:00:14.459882] - Aggregating members...

[2024-11-08 11:00:14.462046] - Done.

[2024-11-08 11:00:14.464226] - Aggregating members...

[2024-11-08 11:00:14.466114] - Done.
</pre></div>
</div>
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>mean</dt><dd>-27.2475711759013</dd><dt>P25</dt><dd>-34.6696350110102</dd><dt>P75</dt><dd>-17.8717848503489</dd></dl>
</div></div>
</div>
<p>At this stage it is easy to operate directly with the data array and use other <code class="docutils literal notranslate"><span class="pre">R</span></code> functionalities, for instance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">boxplot</span><span class="p">(</span><span class="n">rel.anom.regional_mean</span><span class="o">$</span><span class="n">Data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="_images/2437cad7c4662a9c17babc2f7208bd9e7ad37fc0d315eecddfb6265d2126c9ac.png"><img alt="_images/2437cad7c4662a9c17babc2f7208bd9e7ad37fc0d315eecddfb6265d2126c9ac.png" src="_images/2437cad7c4662a9c17babc2f7208bd9e7ad37fc0d315eecddfb6265d2126c9ac.png" style="width: 1080px; height: 480px;" /></a>
</div>
</div>
<p>The <strong><em>climate4R</em> framework provides many other spatial and temporal operations functionalities</strong>, such as <strong>interpolation, subsetting or spatial intersection</strong>. It also provides functionalities for <strong>bias correction and downscaling</strong> (see Iturbide et al., 2019. DOI: <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1364815218303049?via%3Dihub">10.1016/j.envsoft.2018.09.009</a>).</p>
<hr class="docutils" />
</section>
</section>
<section id="session-info">
<h2>Session Info<a class="headerlink" href="#session-info" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sessionInfo</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R version 4.3.3 (2024-02-29)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: Ubuntu 22.04.5 LTS

Matrix products: default
BLAS/LAPACK: /home/zequi/miniconda3/lib/libopenblasp-r0.3.21.so;  LAPACK version 3.9.0

locale:
 [1] LC_CTYPE=en_US.UTF-8          LC_NUMERIC=C                 
 [3] LC_TIME=es_ES.UTF-8           LC_COLLATE=en_US.UTF-8       
 [5] LC_MONETARY=es_ES.UTF-8       LC_MESSAGES=en_US.UTF-8      
 [7] LC_PAPER=es_ES.UTF-8          LC_NAME=es_ES.UTF-8          
 [9] LC_ADDRESS=es_ES.UTF-8        LC_TELEPHONE=es_ES.UTF-8     
[11] LC_MEASUREMENT=es_ES.UTF-8    LC_IDENTIFICATION=es_ES.UTF-8

time zone: Europe/Madrid
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] magrittr_2.0.3      lattice_0.22-6      visualizeR_1.6.4   
[4] transformeR_2.2.2   loadeR_1.8.2        climate4R.UDG_0.2.6
[7] loadeR.java_1.1.1   rJava_1.0-11        repr_1.1.7         

loaded via a namespace (and not attached):
 [1] dotCall64_1.1-1         spam_2.10-0             latticeExtra_0.6-30    
 [4] vctrs_0.6.5             mapplots_1.5.2          tools_4.3.3            
 [7] bitops_1.0-8            generics_0.1.3          parallel_4.3.3         
[10] tibble_3.2.1            proxy_0.4-27            fansi_1.0.6            
[13] SpecsVerification_0.5-3 pkgconfig_2.0.3         data.table_1.15.2      
[16] RColorBrewer_1.1-3      uuid_1.2-1              lifecycle_1.0.4        
[19] compiler_4.3.3          kohonen_3.0.12          deldir_2.0-4           
[22] fields_16.2             munsell_0.5.1           akima_0.6-3.4          
[25] htmltools_0.5.8.1       maps_3.4.2              RCurl_1.98-1.13        
[28] pillar_1.9.0            crayon_1.5.3            MASS_7.3-60.0.1        
[31] boot_1.3-31             abind_1.4-5             vioplot_0.5.0          
[34] padr_0.6.2              verification_1.42       tidyselect_1.2.1       
[37] digest_0.6.37           dplyr_1.1.4             fastmap_1.2.0          
[40] grid_4.3.3              colorspace_2.1-1        cli_3.6.3              
[43] base64enc_0.1-3         utf8_1.2.4              sm_2.2-6.0             
[46] IRdisplay_1.1           withr_3.0.1             scales_1.3.0           
[49] sp_2.1-4                IRkernel_1.3.2          jpeg_0.1-10            
[52] interp_1.1-6            pbdZMQ_0.3-10           RcppEigen_0.3.4.0.1    
[55] zoo_1.8-12              png_0.1-8               pbapply_1.7-2          
[58] evaluate_1.0.0          dtw_1.23-1              viridisLite_0.4.2      
[61] rlang_1.1.4             Rcpp_1.0.13             glue_1.7.0             
[64] easyVerification_0.4.5  CircStats_0.2-6         jsonlite_1.8.9         
[67] R6_2.5.1               
</pre></div>
</div>
</div>
</div>
</section>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="right-next"
       href="maps_of_change/Maps_of_change_under_global-warming-levels.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Projected climate change signals and uncertainty under global warming levels</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contents-in-this-notebook">Contents in this notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aim-and-motivation">1. Aim and motivation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#description-of-the-available-material-within-the-datalab">2. Description of the available material within the datalab</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#software">Software</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-loading-and-basic-data-operations">3. Data loading and basic data operations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-structure-of-the-climate4r-grid">3.3. The structure of the <em>climate4R</em> <code class="docutils literal notranslate"><span class="pre">grid</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-data-exploration-plots">3.4. Initial Data Exploration Plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculation-of-anomalies-future-projections-historical-simulations">3.5. Calculation of anomalies (future projections - historical simulations)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-aggregation">3.6. Spatial aggregation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#session-info">Session Info</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Maialen Iturbide, Ezequiel Cimadevilla
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>